version: '3.8'

services:
  automation-aio:
    image: ghcr.io/workerspages/automation-aio:mariadb
    container_name: automation-aio
    ports:
      - "5000:5000"
    environment:
      - VNC_PW=admin
      - SECRET_KEY=your-secret-key-change-this
      - ADMIN_USERNAME=admin
      - ADMIN_PASSWORD=admin123
      
      # === 数据库配置 (可选：连接外部 MariaDB) ===
      # 如果留空或注释，默认使用容器内置的 SQLite
      - MARIADB_HOST=           # 例如: 192.168.1.100
      - MARIADB_PORT=3306
      - MARIADB_USER=root
      - MARIADB_PASSWORD=root
      - MARIADB_DB=automation_aio
      # =======================================

      # Telegram 通知配置
      - TELEGRAM_BOT_TOKEN=
      - TELEGRAM_CHAT_ID=

      # === 邮件通知配置 ===
      - ENABLE_EMAIL_NOTIFY=true
      - SMTP_HOST=smtp.gmail.com
      - SMTP_PORT=587
      - SMTP_USER=your_email@gmail.com
      - SMTP_PASSWORD=your_app_password
      - EMAIL_FROM=your_email@gmail.com
      - EMAIL_TO=receiver@example.com
      
      - ENABLE_CLOUDFLARE_TUNNEL=false
      - CLOUDFLARE_TUNNEL_TOKEN=xxxxxxxxx
      - DISPLAY=:1
    volumes:
      - ./Downloads:/home/headless/Downloads
      - ./data:/app/data
      - ./logs:/app/logs
    restart: unless-stopped
    shm_size: '2gb'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
