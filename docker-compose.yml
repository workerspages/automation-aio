version: '3.8'

services:
  automation-aio:
    image: ghcr.io/workerspages/automation-aio:paas
    container_name: automation-aio
    ports:
      - "8080:8080"
    environment:
      - VNC_RESOLUTION=1360x768               # 远程桌面分辨率 (PaaS优化: 降低至1360x768节省内存)
      - TZ=Asia/Shanghai                      # 容器时区
      - VNC_PW=admin
      - SECRET_KEY=your-secret-key-change-this
      - ADMIN_USERNAME=admin
      - ADMIN_PASSWORD=admin123
      - DISPLAY=:1                            # 显示面画在编号为 1 的虚拟显示器上 (请误修改)
      - MAX_SCRIPT_TIMEOUT=600                # 全局环境变量-如果你代码里的 sleep 时间超过了 600 秒，Flask 后端会认为任务卡死

      # === 数据库配置 (可选：连接外部 MariaDB) ===
      # --- 数据库 (可选，留空默认使用内置 SQLite) ---
      # 如需外接 MariaDB/MySQL，请填写以下变量:
    # - MARIADB_HOST= # 例如: 192.168.1.100
    # - MARIADB_PORT=3306
    # - MARIADB_USER=root
    # - MARIADB_PASSWORD=root
    # - MARIADB_DB=automation_aio
      # =======================================

      # === Telegram 通知配置 ===
      - TELEGRAM_BOT_TOKEN=
      - TELEGRAM_CHAT_ID=

      # === 邮件通知配置 ===
       # 开启邮件通知:true   关闭邮件通知:false 
      - ENABLE_EMAIL_NOTIFY=false
      - SMTP_HOST=smtp.gmail.com
      - SMTP_PORT=587
      - SMTP_USER=your_email@gmail.com
      - SMTP_PASSWORD=your_app_password
      - EMAIL_FROM=your_email@gmail.com
      - EMAIL_TO=receiver@example.com

      # === AI 验证码识别配置 ===
      - OPENAI_API_KEY=
      - OPENAI_API_BASE=https://api.openai.com/v1
      - AI_MODEL=gpt-4o

      # === Cloudflare Tunnel 配置 ===
      # 必须提供 Token，否则脚本会报错并跳过启动  开启:true 关闭:false 
      - ENABLE_CLOUDFLARE_TUNNEL=false
      - CLOUDFLARE_TUNNEL_TOKEN=eyJhIjoi...
      - APP_PUBLIC_DOMAIN=                                         # Cloudflare Tunnel后台配置的域名
    volumes:
      - ./Downloads:/home/headless/Downloads
      - ./data:/app/data
      - ./logs:/app/logs
      - ./scripts:/home/headless/.config/autokey/data/MyScripts    # autokey脚本文件目录
    restart: unless-stopped
    shm_size: '2gb'
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8080/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
